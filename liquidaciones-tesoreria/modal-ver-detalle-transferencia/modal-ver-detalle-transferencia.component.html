<!-- MODAL DETALLE DE TRANSFERENCIAS (Minimal / Pro) -->
<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/40" (click)="cerrar.emit()" role="dialog"
    aria-modal="true" aria-labelledby="titulo-detalle-transferencias">

    <!-- Contenedor del modal -->
    <div class="relative bg-white rounded-lg shadow-xl w-full max-w-5xl mx-4 my-8 overflow-hidden flex flex-col h-[90dvh] max-h-screen"
        (click)="$event.stopPropagation()">

        <!-- Header (sticky) -->
        <div class="sticky top-0 z-10 bg-white border-b">
            <div class="flex items-center justify-between px-4 py-3">
                <div class="min-w-0">
                    <h3 id="titulo-detalle-transferencias" class="text-lg font-semibold text-gray-800">
                        Detalle de Transferencias
                    </h3>
                    <div class="mt-0.5 text-xs text-gray-500" *ngIf="factura">
                        <span class="inline-flex items-center gap-2">
                            <span class="truncate">
                                Factura: <span class="font-mono text-gray-900">{{ factura.numero_factura }}</span>
                            </span>
                            <span class="hidden sm:inline text-gray-300">•</span>
                            <span class="truncate">Tipo DTE: <span class="text-gray-900">{{ factura.tipo_dte
                                    }}</span></span>
                        </span>
                    </div>
                </div>

                <div class="flex items-center gap-2">
                    <!-- (Opcional) botón extra: imprimir/descargar -->
                    <!-- <button class="px-3 py-1.5 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200">Imprimir</button> -->

                    <button (click)="cerrar.emit()"
                        class="p-2 rounded-md text-gray-500 hover:text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        aria-label="Cerrar">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Contenido scroll -->
        <div class="flex-1 overflow-y-auto p-4 bg-gray-50">
            <div class="space-y-4" *ngIf="factura">

                <!-- Información de la Factura -->
                <section class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="px-4 py-3 border-b">
                        <h4 class="text-sm font-medium text-gray-700">Información de la factura</h4>
                    </div>
                    <div class="p-4">
                        <dl class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div class="min-w-0">
                                <dt class="text-gray-500">Emisor</dt>
                                <dd class="mt-0.5 font-medium text-gray-900 truncate">{{ factura.nombre_emisor }}</dd>
                            </div>
                            <div>
                                <dt class="text-gray-500">Tipo DTE</dt>
                                <dd class="mt-0.5 font-medium text-gray-900">{{ factura.tipo_dte }}</dd>
                            </div>
                            <div>
                                <dt class="text-gray-500">Fecha de emisión</dt>
                                <dd class="mt-0.5 font-medium text-gray-900">{{ formatFecha(factura.fecha_emision) }}
                                </dd>
                            </div>
                            <div>
                                <dt class="text-gray-500">Monto total</dt>
                                <dd class="mt-0.5 font-semibold text-gray-900">{{
                                    formatMonto(factura.monto_total_factura) }}</dd>
                            </div>
                        </dl>
                    </div>
                </section>

                <!-- Transferencias -->
                <section class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="px-4 py-3 border-b flex items-center justify-between">
                        <h4 class="text-sm font-medium text-gray-700">Transferencias</h4>
                        <span class="text-xs text-gray-500">{{ factura.transferencias.length }} detalle(s)</span>
                    </div>

                    <div class="divide-y divide-gray-100">
                        <div *ngFor="let trans of factura.transferencias; let i = index" class="p-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-3 text-sm">
                                <div class="min-w-0">
                                    <div class="text-gray-500">Cuenta</div>
                                    <div class="mt-0.5 text-gray-900 truncate">{{ trans.nombre_cuenta }}</div>
                                </div>
                                <div>
                                    <div class="text-gray-500">Número</div>
                                    <div class="mt-0.5 font-mono text-gray-900">{{ trans.numero_cuenta }}</div>
                                </div>
                                <div>
                                    <div class="text-gray-500">Banco</div>
                                    <div class="mt-0.5 text-gray-900">{{ trans.nombre_banco }}</div>
                                </div>
                                <div>
                                    <div class="text-gray-500">Tipo</div>
                                    <div class="mt-0.5 text-gray-900">{{ trans.tipo_cuenta }}</div>
                                </div>
                                <div class="min-w-0">
                                    <div class="text-gray-500">Correo</div>
                                    <div class="mt-0.5 text-gray-900 truncate">{{ trans.correo_proveedor || 'N/A' }}
                                    </div>
                                </div>
                                <div>
                                    <div class="text-gray-500">Monto</div>
                                    <div class="mt-0.5 font-semibold text-green-600">{{ formatMonto(trans.monto) }}
                                    </div>
                                </div>
                            </div>

                            <div class="mt-3" *ngIf="trans.observaciones">
                                <div class="text-gray-500 text-sm">Observaciones</div>
                                <p
                                    class="mt-1 text-sm text-gray-800 bg-gray-50 px-3 py-2 rounded border border-gray-200">
                                    {{ trans.observaciones }}
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Retenciones -->
                <section class="bg-white rounded-lg shadow-sm border border-gray-200"
                    *ngIf="factura.retenciones.length > 0">
                    <div class="px-4 py-3 border-b flex items-center justify-between">
                        <h4 class="text-sm font-medium text-gray-700">Retenciones</h4>
                        <span class="text-xs text-gray-500">{{ factura.retenciones.length }} detalle(s)</span>
                    </div>

                    <div class="divide-y divide-gray-100">
                        <div *ngFor="let ret of factura.retenciones" class="p-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-3 text-sm">
                                <div>
                                    <div class="text-gray-500">Tipo</div>
                                    <div class="mt-0.5 text-gray-900">{{ ret.nombre }}</div>
                                </div>
                                <div>
                                    <div class="text-gray-500">Monto</div>
                                    <div class="mt-0.5 font-semibold text-red-600">{{ formatMonto(ret.monto) }}</div>
                                </div>
                                <div *ngIf="ret.numero_retencion">
                                    <div class="text-gray-500">N° Retención</div>
                                    <div class="mt-0.5 font-mono text-gray-900">{{ ret.numero_retencion }}</div>
                                </div>
                                <div>
                                    <div class="text-gray-500">Fecha</div>
                                    <div class="mt-0.5 text-gray-900">{{ formatFecha(ret.fecha_retencion) }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Resumen -->
                <section class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="px-4 py-3 border-b">
                        <h4 class="text-sm font-medium text-gray-700">Resumen</h4>
                    </div>
                    <div class="p-4">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                            <div class="rounded-lg border border-gray-200 p-4 text-center">
                                <div class="text-xs text-gray-500">Total transferencias</div>
                                <div class="mt-1 text-xl font-semibold text-gray-900">
                                    {{ formatMonto(factura.monto_total_transferencias) }}
                                </div>
                            </div>
                            <div class="rounded-lg border border-gray-200 p-4 text-center">
                                <div class="text-xs text-gray-500">Total retenciones</div>
                                <div class="mt-1 text-xl font-semibold text-red-600">
                                    {{ formatMonto(factura.monto_total_retenciones) }}
                                </div>
                            </div>
                            <div class="rounded-lg border border-gray-200 p-4 text-center bg-blue-50">
                                <div class="text-xs text-gray-600">Pendiente de pago</div>
                                <div class="mt-1 text-2xl font-bold text-blue-700">
                                    {{ formatMonto(factura.monto_pendiente_pago) }}
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

            </div>
        </div>

        <!-- Footer (sticky) -->
        <div class="sticky bottom-0 bg-white border-t px-4 py-3 flex justify-end">
            <button (click)="cerrar.emit()"
                class="px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                Cerrar
            </button>
        </div>

    </div>
</div>