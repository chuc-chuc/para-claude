<div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden">
    <!-- Header -->
    <div class="px-3 py-2 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
        <div class="text-sm font-medium text-gray-900 dark:text-gray-100">Detalle de Liquidaci√≥n</div>
        <div class="space-x-2">
            <button class="px-3 py-1.5 text-sm rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50"
                (click)="agregar.emit()" [disabled]="!habilitarAcciones || factura?.estado_id === 2">
                Agregar
            </button>
            <button class="px-3 py-1.5 text-sm rounded-md bg-green-600 text-white hover:bg-green-700 disabled:opacity-50"
                (click)="guardarTodo.emit()" [disabled]="!habilitarAcciones || !detalles.length">
                Guardar
            </button>
        </div>
    </div>

    <!-- Tabla -->
    <div class="relative overflow-x-auto">
        <table class="w-full text-sm">
            <thead class="bg-gray-50 dark:bg-gray-700 sticky top-0 z-10">
                <tr class="text-left">
                    <th class="px-3 py-2">Orden</th>
                    <th class="px-3 py-2">Agencia</th>
                    <th class="px-3 py-2">Descripci√≥n</th>
                    <th class="px-3 py-2 text-right">Monto</th>
                    <th class="px-3 py-2">Proveedor</th>
                    <th class="px-3 py-2">Forma pago</th>
                    <th class="px-3 py-2">Banco</th>
                    <th class="px-3 py-2">Cuenta</th>
                    <th class="px-3 py-2 text-center">Acciones</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-100 dark:divide-gray-700">
                <tr *ngFor="let r of detalles; let i = index; trackBy: trackById"
                    class="hover:bg-gray-50 dark:hover:bg-gray-700/40">
                    <td class="px-3 py-2 font-medium">{{ r?.numero_orden }}</td>
                    <td class="px-3 py-2">{{ r?.agencia }}</td>
                    <td class="px-3 py-2">
                        <div class="max-w-xs truncate" [title]="r?.descripcion">{{ r?.descripcion }}</div>
                    </td>
                    <td class="px-3 py-2 text-right">Q{{ r?.monto | number: '1.2-2' }}</td>
                    <td class="px-3 py-2">{{ r?.correo_proveedor }}</td>
                    <td class="px-3 py-2">
                        <select class="text-sm border rounded px-2 py-1 dark:bg-gray-700 dark:text-gray-100"
                            [(ngModel)]="r.forma_pago" (change)="onCambiarFormaPago(i, r.forma_pago)">
                            <option [ngValue]="null" disabled>Seleccionar‚Ä¶</option>
                            <option *ngFor="let tp of tiposPago" [ngValue]="tp?.id || tp?.nombre">
                                {{ tp?.nombre || tp }}
                            </option>
                        </select>
                    </td>
                    <td class="px-3 py-2">{{ r?.banco }}</td>
                    <td class="px-3 py-2">{{ r?.cuenta }}</td>
                    <td class="px-3 py-2">
                        <div class="flex items-center justify-center gap-1">
                            <button class="p-1.5 rounded hover:bg-amber-50 text-amber-700 dark:hover:bg-amber-900/30"
                                (click)="editar.emit(i)" [disabled]="!habilitarAcciones || factura?.estado_id === 2"
                                title="Editar">
                                ‚úé
                            </button>
                            <button class="p-1.5 rounded hover:bg-sky-50 text-sky-700 dark:hover:bg-sky-900/30"
                                (click)="copiar.emit(i)" [disabled]="!habilitarAcciones || factura?.estado_id === 2"
                                title="Copiar">
                                ‚ßâ
                            </button>
                            <button class="p-1.5 rounded hover:bg-red-50 text-red-700 dark:hover:bg-red-900/30"
                                (click)="eliminar.emit(i)" [disabled]="!habilitarAcciones || factura?.estado_id === 2"
                                title="Eliminar">
                                üóë
                            </button>
                        </div>
                    </td>
                </tr>

                <tr *ngIf="!detalles.length">
                    <td colspan="9" class="px-6 py-10 text-center text-gray-500 dark:text-gray-400">
                        Sin registros de liquidaci√≥n. Usa ‚ÄúAgregar‚Äù para crear uno nuevo.
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>