<section class="w-full space-y-4 mt-2">
    <!-- Tabla de liquidaciones -->
    <app-tabla-detalle-liquidizacion [factura]="factura" [detalles]="detalles" [agencias]="agencias"
        [tiposPago]="tiposPago" [habilitarAcciones]="habilitarAcciones && !isSaving" (agregar)="onAgregar()"
        (editar)="onEditar($event)" (eliminar)="onEliminar($event)" (copiar)="onCopiar($event)"
        (guardarTodo)="onGuardarTodo()" (cambiarFormaPago)="onCambiarFormaPago($event)">
    </app-tabla-detalle-liquidizacion>

    <!-- Resumen -->
    <app-resumen-liquidacion [count]="detalles.length" [total]="total" [montoFactura]="montoFactura"
        [estadoMonto]="estadoMonto">
    </app-resumen-liquidacion>

    <!-- Modal agregar/editar detalle -->
    <app-modal-detalle-liquidizacion *ngIf="mostrarModalDetalle()" [visible]="mostrarModalDetalle()"
        [modo]="modoModal()" [registro]="registroEnEdicion" [factura]="factura"
        [facturaActualId]="obtenerFacturaActualId()" [totalMontoRegistros]="obtenerTotalMontoRegistros()"
        (guardar)="onGuardarDesdeModal($event)"
        (cancelar)="onCancelarModal()">
    </app-modal-detalle-liquidizacion>

    <!-- Modal confirmar eliminación -->
    <app-modal-confirmar-eliminacion *ngIf="mostrarModalEliminar()" [titulo]="'Confirmar eliminación'"
        [mensaje]="'¿Está seguro(a) de eliminar este detalle? Esta acción no se puede deshacer.'"
        (confirmar)="onConfirmarEliminar()" (cancelar)="onCancelarEliminar()">
    </app-modal-confirmar-eliminacion>

    <!-- Indicadores -->
    <div *ngIf="isLoading" class="fixed inset-0 bg-black/20 flex items-center justify-center z-40">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl">
            <div class="flex items-center space-x-3">
                <div class="w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
                <span class="text-gray-700 dark:text-gray-200">Cargando datos...</span>
            </div>
        </div>
    </div>

    <div *ngIf="isSaving"
        class="fixed bottom-4 right-4 bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg flex items-center space-x-2 z-50">
        <div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
        <span class="text-sm">Guardando cambios...</span>
    </div>
</section>