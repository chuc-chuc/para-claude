<section class="w-full space-y-4 mt-2">
    <!-- Tabla de liquidaciones -->
    <app-tabla-detalle-liquidizacion (mostrarModal)="abrirModal()" (editarDetalle)="abrirModalEditar($event)"
        (eliminarDetalle)="indexAEliminar = $event; mostrarModalEliminar.set(true)"
        (copiarDetalle)="copiarDetalle($event)"
        (cambiarFormaPago)="cambiarFormaPagoEvent($event.index, $event.tipo)"></app-tabla-detalle-liquidizacion>

    <!-- Resumen -->
    <app-resumen-liquidacion *ngIf="datosResumen$ | async as datos" [count]="datos.cantidad" [total]="datos.total"
        [montoFactura]="datos.montoFactura" [estadoMonto]="datos.estadoMonto"></app-resumen-liquidacion>

    <!-- Modal agregar/editar detalle -->
    <app-modal-detalle-liquidizacion *ngIf="mostrarModalDetalle()" [visible]="mostrarModalDetalle()"
        [modo]="modoModal()" [registro]="registroEnEdicion"></app-modal-detalle-liquidizacion>

    <!-- Modal confirmar eliminación -->
    <app-modal-confirmar-eliminacion *ngIf="mostrarModalEliminar()" [titulo]="'Confirmar eliminación'"
        [mensaje]="'¿Está seguro(a) de eliminar este detalle? Esta acción no se puede deshacer.'"
        (confirmar)="confirmarEliminacion()" (cancelar)="cancelarEliminacion()"></app-modal-confirmar-eliminacion>

    <!-- Indicadores de estado -->
    <div *ngIf="loadingDetalles$ | async" class="fixed inset-0 bg-black/20 flex items-center justify-center z-40">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl">
            <div class="flex items-center space-x-3">
                <div class="w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
                <span class="text-gray-700 dark:text-gray-200">Cargando datos...</span>
            </div>
        </div>
    </div>

    <div *ngIf="savingDetalles$ | async"
        class="fixed bottom-4 right-4 bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg flex items-center space-x-2 z-50">
        <div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
        <span class="text-sm">Guardando cambios...</span>
    </div>
</section>