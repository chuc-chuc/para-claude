<!-- ============================================================================ -->
<!-- APROBACIONES DE TRANSFERENCIAS -->
<!-- ============================================================================ -->

<div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-4">
    <div class="mx-auto max-w-[1600px]">

        <!-- ================================================================ -->
        <!-- HEADER -->
        <!-- ================================================================ -->
        <div class="bg-white rounded-xl shadow-sm p-6 mb-6 border border-gray-100">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-6">
                <div>
                    <h1
                        class="text-2xl sm:text-3xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                        Aprobaciones de Transferencias
                    </h1>
                    <p class="text-sm text-gray-500 mt-1">Solicitudes pendientes de aprobación</p>
                </div>

                <!-- Botón Actualizar -->
                <button (click)="refrescarDatos()" [disabled]="cargando()"
                    class="inline-flex items-center gap-2 px-4 py-2.5 bg-white border-2 border-purple-600 text-purple-600 rounded-lg hover:bg-purple-50 disabled:opacity-50 text-sm font-medium transition-all">
                    <lucide-icon [img]="RefreshCw" [class.animate-spin]="cargando()" class="w-4 h-4"></lucide-icon>
                    <span *ngIf="!cargando()">Actualizar</span>
                    <span *ngIf="cargando()">Cargando...</span>
                </button>
            </div>

            <!-- Estadísticas -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200">
                    <div class="flex items-center justify-between mb-2">
                        <p class="text-xs font-medium text-purple-700">Solicitudes Pendientes</p>
                        <span class="bg-purple-200 text-purple-800 px-2 py-1 rounded-full text-xs font-bold">
                            {{totalSolicitudes()}}
                        </span>
                    </div>
                    <p class="text-xl font-bold text-purple-800">Por Revisar</p>
                </div>

                <div class="bg-gradient-to-br from-pink-50 to-pink-100 rounded-lg p-4 border border-pink-200">
                    <div class="flex items-center justify-between mb-2">
                        <p class="text-xs font-medium text-pink-700">Monto Total Pendiente</p>
                    </div>
                    <p class="text-xl font-bold text-pink-800">{{formatMonto(montoTotalPendiente())}}</p>
                </div>
            </div>
        </div>

        <!-- ================================================================ -->
        <!-- LISTA DE SOLICITUDES PENDIENTES -->
        <!-- ================================================================ -->
        <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-gray-100">

            <!-- Estado de carga -->
            <div *ngIf="cargando()" class="text-center py-12">
                <div
                    class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-purple-600 border-t-transparent">
                </div>
                <p class="mt-4 text-sm text-gray-600 font-medium">Cargando solicitudes pendientes...</p>
            </div>

            <!-- Sin datos -->
            <div *ngIf="!cargando() && solicitudesPendientes().length === 0" class="text-center py-12">
                <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-green-100 mb-4">
                    <lucide-icon [img]="CheckCircle" class="w-8 h-8 text-green-600"></lucide-icon>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">¡Todo al día!</h3>
                <p class="text-sm text-gray-500">No hay solicitudes pendientes de aprobar</p>
            </div>

            <!-- Tabla de solicitudes -->
            <div *ngIf="!cargando() && solicitudesPendientes().length > 0" class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th
                                class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                Código
                            </th>
                            <th
                                class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                Banco Origen
                            </th>
                            <th
                                class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                Monto
                            </th>
                            <th
                                class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                Fecha Solicitud
                            </th>
                            <th
                                class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                Antigüedad
                            </th>
                            <th
                                class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                Acciones
                            </th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <tr *ngFor="let solicitud of solicitudesPendientes(); trackBy: trackBySolicitud"
                            class="hover:bg-purple-50/50 transition-colors">

                            <!-- Código -->
                            <td class="px-4 py-3">
                                <div class="font-mono font-semibold text-purple-900">
                                    {{solicitud.codigo_solicitud}}
                                </div>
                            </td>

                            <!-- Banco -->
                            <td class="px-4 py-3">
                                <div class="text-sm font-semibold text-gray-900">{{solicitud.banco_nombre}}</div>
                                <div class="text-xs text-gray-500">{{solicitud.banco_cuenta}}</div>
                            </td>

                            <!-- Monto -->
                            <td class="px-4 py-3">
                                <div class="text-base font-bold text-green-600">
                                    {{formatMonto(solicitud.monto_total_solicitud)}}
                                </div>
                            </td>

                            <!-- Fecha -->
                            <td class="px-4 py-3">
                                <div class="text-sm text-gray-700">{{formatFecha(solicitud.fecha_creacion)}}</div>
                                <div class="text-xs text-gray-500">{{formatFechaHora(solicitud.fecha_creacion).split('
                                    ')[1]}}</div>
                            </td>

                            <!-- Antigüedad -->
                            <td class="px-4 py-3">
                                <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium"
                                    [class]="getColorAntiguedad(diasDesdeCreacion(solicitud.fecha_creacion))">
                                    {{diasDesdeCreacion(solicitud.fecha_creacion)}} día(s)
                                </span>
                            </td>

                            <!-- Acciones -->
                            <td class="px-4 py-3">
                                <div class="flex items-center justify-center gap-1">
                                    <!-- Ver detalle -->
                                    <button (click)="verDetalleSolicitud(solicitud)" title="Ver detalle"
                                        class="p-2 text-blue-600 hover:bg-blue-100 rounded-lg transition-all">
                                        <lucide-icon [img]="Eye" class="w-5 h-5"></lucide-icon>
                                    </button>

                                    <!-- Aprobar -->
                                    <button (click)="aprobarSolicitud(solicitud)" title="Aprobar solicitud"
                                        class="p-2 text-green-600 hover:bg-green-100 rounded-lg transition-all">
                                        <lucide-icon [img]="CheckCircle" class="w-5 h-5"></lucide-icon>
                                    </button>

                                    <!-- Rechazar -->
                                    <button (click)="rechazarSolicitud(solicitud)" title="Rechazar solicitud"
                                        class="p-2 text-red-600 hover:bg-red-100 rounded-lg transition-all">
                                        <lucide-icon [img]="XCircle" class="w-5 h-5"></lucide-icon>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <!-- Footer -->
                <div class="bg-gray-50 px-4 py-3 border-t border-gray-200">
                    <p class="text-sm text-gray-600">
                        Mostrando <span class="font-semibold text-purple-600">{{solicitudesPendientes().length}}</span>
                        solicitud(es) pendiente(s) de aprobación
                    </p>
                </div>
            </div>
        </div>

        <!-- Información adicional -->
        <div class="mt-6 bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg">
            <div class="flex items-start gap-3">
                <lucide-icon [img]="AlertCircle" class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"></lucide-icon>
                <div class="text-sm text-blue-800">
                    <p class="font-semibold mb-1">Importante:</p>
                    <ul class="list-disc list-inside space-y-1 text-xs">
                        <li>Revise cuidadosamente los detalles antes de aprobar</li>
                        <li>Al aprobar, la solicitud pasa a tesorería para registrar el comprobante</li>
                        <li>Al rechazar, debe proporcionar un comentario explicando el motivo</li>
                        <li>Las solicitudes rechazadas pueden ser editadas y reenviadas por tesorería</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ================================================================ -->
<!-- MODALES -->
<!-- ================================================================ -->

<!-- Modal: Aprobar/Rechazar Solicitud -->
<app-modal-aprobar-rechazar-solicitud *ngIf="mostrarModalAprobacion()" [solicitud]="solicitudSeleccionada()"
    [accion]="accionModal()" (cerrar)="cerrarModalAprobacion()" (confirmado)="onAccionCompletada()">
</app-modal-aprobar-rechazar-solicitud>

<!-- Modal: Ver Detalle de Factura -->
<app-modal-ver-detalle-factura *ngIf="mostrarModalDetalle()" [factura]="facturaSeleccionada()"
    (cerrar)="cerrarModalDetalle()">
</app-modal-ver-detalle-factura>